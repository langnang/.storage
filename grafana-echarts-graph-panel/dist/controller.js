"use strict";System.register(["app/plugins/sdk","lodash","app/core/utils/kbn","./libs/echarts.min","./libs/dark","./style.css!","./data_processor","./data_formatter","./utils"],function(a,b){function c(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v;return{setters:[function(a){g=a.MetricsPanelCtrl},function(a){h=a["default"]},function(a){i=a["default"]},function(a){j=a["default"]},function(a){},function(a){},function(a){k=a.DataProcessor},function(a){l=a["default"]},function(a){m=a.randomColor,n=a.xAxis,o=a.zeroToNull,p=a.markLine,q=a.to_date,r=a.to_utt_date,s=a.time_interval,t=a.date_diff_compare}],execute:function(){u=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),a("Controller",v=function(a){function b($scope,$injector){d(this,b);var a=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,$scope,$injector)),c={IS_UCD:!1,METHODS:["POST","GET"],ETYPE:["line","pie","map"],url:"",debug:{print:!1},method:"POST",upInterval:6e4,format:"Year",markLine:{show:!1,type:"average",precision:2,formatter:"{c}"}};return c.setOption={legend:{show:!1,type:"plain",left:"auto",top:"bottom",align:"auto",orient:"horizontal",icon:"roundRect",data:[]},grid:{left:"10%",top:"60",right:"10%",bottom:"60",containLabel:!1},xAxis:[{type:"category",data:[],boundaryGap:!1,splitLine:{show:!1,lineStyle:{type:"solid",opacity:"0.3"}}}],yAxis:[{type:"value",axisLabel:{show:!0,interval:"auto",formatter:"{value}"},splitLine:{show:!1,lineStyle:{type:"solid",opacity:"0.3"}}}],tooltip:{show:!1,trigger:"axis",axisPointer:{type:"line"}},toolbox:{show:!1,orient:"horizontal",feature:{magicType:{type:["line","bar","stack","tiled"]},restore:{}},left:"auto",top:"auto"},series:[],color:["#7EB26D","#EAB839","#6ED0E0","#EF843C","#E24D42","#1F78C1","#BA43A9","#705DA0","#508642","#CCA300","#447EBC"],animation:!1,visualMap:{show:!1,min:0,max:300,inRange:{color:["red","yellow","green"]}}},c.spareOption={series:{type:[],smooth:[],stack:[],step:[],symbolSize:[],itemStyle:{normal:{lineStyle:{width:[]},areaStyle:{opacity:[]}}}}},h.defaults(a.panel,c),a.dataFormatter=new l(a,i),a.processor=new k(a.panel),a.events.on("data-received",a.onDataReceived.bind(a)),a.events.on("data-error",a.onDataError.bind(a)),a.events.on("data-snapshot-load",a.onDataReceived.bind(a)),a.events.on("init-edit-mode",a.onInitEditMode.bind(a)),a.events.on("panel-initialized",a.render.bind(a)),a.refreshData(),a}return f(b,a),u(b,[{key:"onDataReceived",value:function(a){if(this.seriesList={dataList:a,xAxisOp:[],seriesOp:[]},delete this.panel.setOption.visualMap,delete this.panel.setOption.xAxis[0].axisLabel,delete this.panel.setOption.tooltip.formatter,n(this.panel.format,a))this.seriesList.xAxisOp=n(this.panel.format,a);else if("Series"===this.panel.format){var b=[];a.forEach(function(a){b.push(a.target)}),this.seriesList.xAxisOp=b,this.panel.setOption.visualMap={show:!1,inRange:{color:this.panel.setOption.color}},this.panel.setOption.tooltip.formatter="{b}:{c}",this.panel.setOption.xAxis[0].axisLabel={formatter:function(a){return a.split("").join("\n")}}}else if("Custom-FullMonth"===this.panel.format){for(var d in a){var e=new Date(a[d].datapoints[0][1]).getFullYear(),f=new Date(a[d].datapoints[0][1]).getMonth();if(0!==f)for(var g=f-1;g>=0;g--)a[d].datapoints.unshift([0,new Date(e+"/"+(g+1)+"/1").getTime()]);if(a[d].datapoints.length<12)for(var h=a[d].datapoints.length,i=h;i<12;i++)a[d].datapoints.push([0,new Date(e+"/"+(i+1)+"/1").getTime()])}for(var j in a[0].datapoints)this.seriesList.xAxisOp.push(new Date(a[0].datapoints[j][1]).getFullYear()+"-"+(new Date(a[0].datapoints[j][1]).getMonth()+1))}else{var k=[],l=[],r=[];for(var u in a)for(var v in a[u].datapoints)r.push(a[u].datapoints[v][1]);for(var w=Math.max.apply(Math,r),x=Math.min.apply(Math,r);x<=w;)l.push(x),k.push(q(new Date(x),this.panel.format)),x+=s(this.panel.format,x);k=new Set(k),k=Array.from(k),this.seriesList.xAxisOp=k;for(var y in a)for(var z in a[y].datapoints)t(l,a[y].datapoints)}for(var A in a){"Series"===this.panel.format&&(A=0),void 0==this.panel.spareOption.series.type[A]&&(this.panel.spareOption.series.type[A]="line"),void 0==this.panel.spareOption.series.smooth[A]&&(this.panel.spareOption.series.smooth[A]=!1),void 0==this.panel.spareOption.series.stack[A]&&(this.panel.spareOption.series.stack[A]=!1),void 0==this.panel.spareOption.series.step[A]&&(this.panel.spareOption.series.step[A]=!1),void 0==this.panel.spareOption.series.symbolSize[A]&&(this.panel.spareOption.series.symbolSize[A]=4),void 0==this.panel.spareOption.series.itemStyle.normal.lineStyle.width[A]&&(this.panel.spareOption.series.itemStyle.normal.lineStyle.width[A]=1),void 0==this.panel.spareOption.series.itemStyle.normal.areaStyle.opacity[A]&&(this.panel.spareOption.series.itemStyle.normal.areaStyle.opacity[A]=0);var B={name:a[A].target,type:this.panel.spareOption.series.type[A],smooth:this.panel.spareOption.series.smooth[A],stack:this.panel.spareOption.series.stack[A],step:this.panel.spareOption.series.step[A],symbolSize:this.panel.spareOption.series.symbolSize[A],itemStyle:{normal:{lineStyle:{width:this.panel.spareOption.series.itemStyle.normal.lineStyle.width[A]},areaStyle:{opacity:this.panel.spareOption.series.itemStyle.normal.areaStyle.opacity[A]}}},data:[]};if("Series"===this.panel.format){this.seriesList.seriesOp[0]=B;for(var C in a)this.seriesList.seriesOp[0].data.push(a[C].datapoints[0][0]);this.panel.setOption.visualMap.max=Math.max.apply(Math,c(this.seriesList.seriesOp[0].data))}else{this.seriesList.seriesOp.push(B);for(var D in a[A].datapoints)this.seriesList.seriesOp[A].data.push(a[A].datapoints[D][0])}this.seriesList.seriesOp[A].data=o.apply(void 0,c(this.seriesList.seriesOp[A].data)),void 0===this.panel.setOption.color[A]&&(this.panel.setOption.color[A]=m())}this.panel.markLine.show&&this.seriesList.seriesOp.length>0&&(this.seriesList.seriesOp=p(this.seriesList.seriesOp,this.panel.markLine)),this.refreshed=!0,this.render(),this.refreshed=!1}},{key:"onDataError",value:function(a){this.series=[],this.render()}},{key:"onInitEditMode",value:function(){this.addEditorTab("Axis","public/plugins/echarts-graph-panel/partials/axis.html",2),this.addEditorTab("Option","public/plugins/echarts-graph-panel/partials/options.html",3)}},{key:"refreshData",value:function(){var a=this,b=this,c=void 0;c=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");c.onreadystatechange=function(){4==c.readyState&&200==c.status&&(b.customizeData=JSON.parse(c.responseText),b.onDataReceived())},this.panel.IS_UCD?(c.open(b.panel.method,b.panel.url,!0),c.send()):c=null,this.$timeout(function(){a.refreshData()},b.panel.upInterval)}},{key:"link",value:function(a,b,c,d){function e(){var a=d.height||d.panel.height;h.isString(a)&&(a=parseInt(a.replace("px",""),10)),a+=0,g.style.height=a+"px"}function f(){if(i&&(e(),i.resize(),d.refreshed)){i.clear(),void 0!==d.seriesList?(d.panel.setOption.xAxis[0].data=d.seriesList.xAxisOp,d.panel.setOption.series=d.seriesList.seriesOp):(d.panel.setOption.xAxis[0].data=[],d.panel.setOption.series=[]),d.panel.setOption.legend.data=[];for(var a in d.panel.setOption.series)d.panel.setOption.legend.data.push(d.panel.setOption.series[a].name);i.setOption(d.panel.setOption)}}var g=b.find(".echarts_container")[0];d.refreshed=!0,e();var i=j.init(g,"dark");setTimeout(function(){i.resize()},1e3),this.events.on("render",function(){f(),d.renderingCompleted()})}}]),b}(g)),a("Controller",v),v.templateUrl="partials/module.html"}}});
//# sourceMappingURL=controller.js.map